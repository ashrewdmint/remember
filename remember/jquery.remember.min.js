(function($){$.remember={key_name:'jquery.remember',return_methods:['hasChanges','changes','last','serialize'],silent_methods:['save','restore','forget'],first_only_methods:['last','serialize'],serialize:function(a,b){var c,tag,value,params=[];a.find('[name]:input').each(function(){c=$(this);if(c.attr('type').match(/radio|checkbox/)&&!c.attr('checked')){return}params.push(escape(c.attr('name'))+'='+escape(c.val()))});params=params.join('&');if(b){params=this.objectFromParams(params)}return params},restore:function(f){f=$(f);var g=this.objectFromParams(this.last(f));f.find('[name]').each(function(){var a=$(this);var b=a.attr('name');if(!g[b]){a.attr('checked',false)}});$.each(g,function(a,b){var c=f.find('[name="'+a+'"]');var d=c.attr('type');if(!c.length)return;var e=c.get(0).nodeName.toLowerCase();if(e=='textarea'){c.text(b)}else{switch(d){case'radio':c.each(function(){if($(this).val()==b){$(this).attr('checked',true)}else{$(this).attr('checked',false)}});break;case'checkbox':c.attr('checked',true);break;default:c.val(b);break}}})},save:function(a){this.forget(a);this.last(a)},last:function(a,b){var c=a.data(this.key_name);c=c?c:this.serialize(a);a.data(this.key_name,c);if(b){c=this.objectFromParams(c)}return c},hasChanges:function(a){return this.last(a)!=this.serialize(a)},changes:function(c){var d=this.objectFromParams(this.serialize(c));var e=this.objectFromParams(this.last(c));var f=[];fields=$.extend({},d,e);$.each(fields,function(a,b){if(e[a]!=d[a]){f.push({'name':a,'value':b,'element':$('[name="'+a+'"]')})}});return f},objectFromParams:function(c){var d={};var e=c.split('&');$.each(e,function(a,b){b=unescape(b).split('=');if(b.length>0){d[b[0]]=b[1]}});return d},forget:function(a){return a.removeData(this.key_name)}};$.fn.remember=function(b,c){if(typeof(b)=='undefined'){b='save'}var d=this;var e=[];var f=null;if($.inArray(b,$.remember.first_only_methods)>=0){d=d.eq(0)}if($.inArray(b,$.remember.return_methods)>=0){d.each(function(){var a=$.remember[b]($(this),c);switch(b){case'hasChanges':if(!f){f=a}break;case'changes':if(!$.isArray(f)){f=[]}$.each(a,function(){f.push(this)});break;default:f=a;break}});return f}else if($.inArray(b,$.remember.silent_methods)>=0){d.each(function(){$.remember[b]($(this))})}else{throw'Undefined method "'+b+'" for jQuery plugin remember';}return this}})(jQuery);
